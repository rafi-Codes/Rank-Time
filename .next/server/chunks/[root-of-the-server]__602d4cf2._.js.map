{"version":3,"sources":["../../../../../Rank%20Time%20%28Vibe%29/ranktime/src/lib/db.ts"],"sourcesContent":["// src/lib/db.ts\r\nimport { MongoClient } from 'mongodb';\r\nimport mongoose from 'mongoose';\r\n\r\nif (!process.env.MONGODB_URI) {\r\n  throw new Error('Invalid/Missing environment variable: \"MONGODB_URI\"');\r\n}\r\n\r\nconst uri = process.env.MONGODB_URI;\r\nconst options = {\r\n  maxPoolSize: 10,\r\n  serverSelectionTimeoutMS: 5000,\r\n  socketTimeoutMS: 45000,\r\n  maxIdleTimeMS: 30000,\r\n};\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line no-var\r\n  var _mongoClientPromise: Promise<MongoClient> | undefined;\r\n  // eslint-disable-next-line no-var\r\n  var _mongooseConn: Promise<typeof mongoose> | undefined;\r\n}\r\n\r\nlet client: MongoClient;\r\nlet clientPromise: Promise<MongoClient>;\r\n\r\nif (process.env.NODE_ENV === 'development') {\r\n  // In development mode, use a global variable so that the value\r\n  // is preserved across module reloads caused by HMR (Hot Module Replacement).\r\n  if (!global._mongoClientPromise) {\r\n    client = new MongoClient(uri, options);\r\n    global._mongoClientPromise = client.connect();\r\n  }\r\n  clientPromise = global._mongoClientPromise;\r\n} else {\r\n  // In production mode, it's best to not use a global variable.\r\n  client = new MongoClient(uri, options);\r\n  clientPromise = client.connect();\r\n}\r\n\r\nexport async function connectToDatabase() {\r\n  try {\r\n    const client = await clientPromise;\r\n    return client;\r\n  } catch (error) {\r\n    console.error('Database connection error:', error);\r\n    throw new Error(`Failed to connect to database: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n  }\r\n}\r\n\r\n// Mongoose connection for models â€” cached on global to avoid multiple connections in serverless\r\nexport default async function connectDB() {\r\n  if (global._mongooseConn) {\r\n    return global._mongooseConn;\r\n  }\r\n\r\n  global._mongooseConn = (async () => {\r\n    try {\r\n      return await mongoose.connect(uri);\r\n    } catch (error) {\r\n      console.error('Mongoose connection error:', error);\r\n      global._mongooseConn = undefined;\r\n      throw error;\r\n    }\r\n  })();\r\n\r\n  return global._mongooseConn;\r\n}"],"names":[],"mappings":"0vCAwBI,EAvBJ,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAMA,IAAM,EAAA,wHAgCC,eAAe,IACpB,GAAI,CAEF,OADe,AACR,MADc,CAEvB,CAAE,MAAO,EAAO,CAEd,MADA,QAAQ,KAAK,CAAC,6BAA8B,GACtC,AAAI,MAAM,CAAC,+BAA+B,EAAE,aAAiB,MAAQ,EAAM,OAAO,CAAG,gBAAA,CAAiB,CAC9G,CACF,CAGe,eAAe,WACxB,OAAO,aAAa,EAAE,CAI1B,OAAO,aAAa,CAAG,CAAC,UACtB,GAAI,CACF,OAAO,MAAM,EAAA,OAAQ,CAAC,OAAO,CAAC,EAChC,CAAE,MAAO,EAAO,CAGd,MAFA,QAAQ,KAAK,CAAC,6BAA8B,GAC5C,OAAO,aAAa,CAAG,OACjB,CACR,EACF,CAAC,EAAA,EAXQ,OAAO,aAAa,AAc/B,CA9BE,EADS,AACO,IADH,EAAA,WAAW,CAAC,EA3BX,CACd,EA0B8B,UA1BjB,GACb,yBAA0B,IAC1B,gBAAiB,KACjB,cAAe,GACjB,GAuByB,OAAO"}