{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rafi2/Rank%20Time%20%28Vibe%29/ranktime/src/app/api/codeforces/route.ts"],"sourcesContent":["// src/app/api/codeforces/route.ts\r\nimport { NextRequest, NextResponse } from 'next/server';\r\n\r\nexport const dynamic = 'force-dynamic';\r\n\r\ninterface CodeforcesUser {\r\n  handle: string;\r\n  rating?: number;\r\n  rank?: string;\r\n  maxRating?: number;\r\n  maxRank?: string;\r\n  contribution?: number;\r\n  friendOfCount?: number;\r\n  titlePhoto?: string;\r\n  avatar?: string;\r\n  registrationTimeSeconds?: number;\r\n  lastOnlineTimeSeconds?: number;\r\n}\r\n\r\ninterface CodeforcesSubmission {\r\n  id: number;\r\n  contestId?: number;\r\n  problem: {\r\n    contestId?: number;\r\n    index: string;\r\n    name: string;\r\n    rating?: number;\r\n    tags?: string[];\r\n  };\r\n  verdict: string;\r\n  programmingLanguage: string;\r\n  timeConsumedMillis: number;\r\n  memoryConsumedBytes: number;\r\n  creationTimeSeconds: number;\r\n};\r\n\r\nexport async function GET(request: NextRequest) {\r\n  const { searchParams } = new URL(request.url);\r\n  const handle = searchParams.get('handle');\r\n\r\n  if (!handle) {\r\n    return NextResponse.json(\r\n      { error: 'Handle parameter is required' },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  try {\r\n    // Fetch user info\r\n    const userResponse = await fetch(\r\n      `https://codeforces.com/api/user.info?handles=${encodeURIComponent(handle)}`,\r\n      {\r\n        headers: {\r\n          'User-Agent': 'RankTime-App/1.0',\r\n        },\r\n      }\r\n    );\r\n\r\n    if (!userResponse.ok) {\r\n      throw new Error('Failed to fetch user data from Codeforces');\r\n    }\r\n\r\n    const userData = await userResponse.json();\r\n\r\n    if (userData.status !== 'OK' || !userData.result || userData.result.length === 0) {\r\n      throw new Error('User not found on Codeforces');\r\n    }\r\n\r\n    const user: CodeforcesUser = userData.result[0];\r\n\r\n    // Fetch user submissions (limit to recent 100 for performance)\r\n    const submissionsResponse = await fetch(\r\n      `https://codeforces.com/api/user.status?handle=${encodeURIComponent(handle)}&from=1&count=100`,\r\n      {\r\n        headers: {\r\n          'User-Agent': 'RankTime-App/1.0',\r\n        },\r\n      }\r\n    );\r\n\r\n    let stats = {\r\n      solvedProblems: 0,\r\n      totalSubmissions: 0,\r\n      acceptedSubmissions: 0,\r\n      wrongAnswer: 0,\r\n      timeLimitExceeded: 0,\r\n      memoryLimitExceeded: 0,\r\n      runtimeError: 0,\r\n      compilationError: 0,\r\n      recentSubmissions: [] as any[],\r\n    };\r\n\r\n    if (submissionsResponse.ok) {\r\n      const submissionsData = await submissionsResponse.json();\r\n\r\n      if (submissionsData.status === 'OK' && submissionsData.result) {\r\n        const submissions: CodeforcesSubmission[] = submissionsData.result;\r\n        stats.totalSubmissions = submissions.length;\r\n\r\n        // Track solved problems\r\n        const solvedProblems = new Set<string>();\r\n\r\n        submissions.forEach((submission) => {\r\n          const problemKey = `${submission.problem.contestId || 'gym'}-${submission.problem.index}`;\r\n\r\n          // Count verdict types\r\n          switch (submission.verdict) {\r\n            case 'OK':\r\n              stats.acceptedSubmissions++;\r\n              solvedProblems.add(problemKey);\r\n              break;\r\n            case 'WRONG_ANSWER':\r\n              stats.wrongAnswer++;\r\n              break;\r\n            case 'TIME_LIMIT_EXCEEDED':\r\n              stats.timeLimitExceeded++;\r\n              break;\r\n            case 'MEMORY_LIMIT_EXCEEDED':\r\n              stats.memoryLimitExceeded++;\r\n              break;\r\n            case 'RUNTIME_ERROR':\r\n              stats.runtimeError++;\r\n              break;\r\n            case 'COMPILATION_ERROR':\r\n              stats.compilationError++;\r\n              break;\r\n          }\r\n        });\r\n\r\n        stats.solvedProblems = solvedProblems.size;\r\n\r\n        // Get recent submissions (last 20)\r\n        stats.recentSubmissions = submissions.slice(0, 20).map(submission => ({\r\n          id: submission.id,\r\n          contestId: submission.contestId,\r\n          problem: {\r\n            contestId: submission.problem.contestId,\r\n            index: submission.problem.index,\r\n            name: submission.problem.name,\r\n            rating: submission.problem.rating,\r\n            tags: submission.problem.tags,\r\n          },\r\n          verdict: submission.verdict,\r\n          programmingLanguage: submission.programmingLanguage,\r\n          timeConsumedMillis: submission.timeConsumedMillis,\r\n          memoryConsumedBytes: submission.memoryConsumedBytes,\r\n          creationTimeSeconds: submission.creationTimeSeconds,\r\n        }));\r\n      }\r\n    }\r\n\r\n    return NextResponse.json({\r\n      user,\r\n      stats,\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error('Codeforces API error:', error);\r\n\r\n    return NextResponse.json(\r\n      { error: error.message || 'Failed to fetch data from Codeforces' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}"],"names":[],"mappings":"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"}}]
}