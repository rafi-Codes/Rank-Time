{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rafi2/Rank%20Time%20%28Vibe%29/ranktime/src/lib/db.ts"],"sourcesContent":["// src/lib/db.ts\r\nimport { MongoClient } from 'mongodb';\r\nimport mongoose from 'mongoose';\r\n\r\nif (!process.env.MONGODB_URI) {\r\n  throw new Error('Invalid/Missing environment variable: \"MONGODB_URI\"');\r\n}\r\n\r\nconst uri = process.env.MONGODB_URI;\r\nconst options = {\r\n  maxPoolSize: 10,\r\n  serverSelectionTimeoutMS: 5000,\r\n  socketTimeoutMS: 45000,\r\n  maxIdleTimeMS: 30000,\r\n};\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line no-var\r\n  var _mongoClientPromise: Promise<MongoClient> | undefined;\r\n  // eslint-disable-next-line no-var\r\n  var _mongooseConn: Promise<typeof mongoose> | undefined;\r\n}\r\n\r\nlet client: MongoClient;\r\nlet clientPromise: Promise<MongoClient>;\r\n\r\nif (process.env.NODE_ENV === 'development') {\r\n  // In development mode, use a global variable so that the value\r\n  // is preserved across module reloads caused by HMR (Hot Module Replacement).\r\n  if (!global._mongoClientPromise) {\r\n    client = new MongoClient(uri, options);\r\n    global._mongoClientPromise = client.connect();\r\n  }\r\n  clientPromise = global._mongoClientPromise;\r\n} else {\r\n  // In production mode, it's best to not use a global variable.\r\n  client = new MongoClient(uri, options);\r\n  clientPromise = client.connect();\r\n}\r\n\r\nexport async function connectToDatabase() {\r\n  try {\r\n    const client = await clientPromise;\r\n    return client;\r\n  } catch (error) {\r\n    console.error('Database connection error:', error);\r\n    throw new Error(`Failed to connect to database: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n  }\r\n}\r\n\r\n// Mongoose connection for models â€” cached on global to avoid multiple connections in serverless\r\nexport default async function connectDB() {\r\n  if (global._mongooseConn) {\r\n    return global._mongooseConn;\r\n  }\r\n\r\n  global._mongooseConn = (async () => {\r\n    try {\r\n      return await mongoose.connect(uri);\r\n    } catch (error) {\r\n      console.error('Mongoose connection error:', error);\r\n      global._mongooseConn = undefined;\r\n      throw error;\r\n    }\r\n  })();\r\n\r\n  return global._mongooseConn;\r\n}"],"names":[],"mappings":";;;;;;AAAA,gBAAgB;AAChB;AACA;;;AAEA;;AAIA,MAAM;AACN,MAAM,UAAU;IACd,aAAa;IACb,0BAA0B;IAC1B,iBAAiB;IACjB,eAAe;AACjB;AASA,IAAI;AACJ,IAAI;AAEJ,wCAA4C;IAC1C,+DAA+D;IAC/D,6EAA6E;IAC7E,IAAI,CAAC,OAAO,mBAAmB,EAAE;QAC/B,SAAS,IAAI,0MAAW,CAAC,KAAK;QAC9B,OAAO,mBAAmB,GAAG,OAAO,OAAO;IAC7C;IACA,gBAAgB,OAAO,mBAAmB;AAC5C;;AAMO,eAAe;IACpB,IAAI;QACF,MAAM,SAAS,MAAM;QACrB,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,MAAM,IAAI,MAAM,CAAC,+BAA+B,EAAE,iBAAiB,QAAQ,MAAM,OAAO,GAAG,iBAAiB;IAC9G;AACF;AAGe,eAAe;IAC5B,IAAI,OAAO,aAAa,EAAE;QACxB,OAAO,OAAO,aAAa;IAC7B;IAEA,OAAO,aAAa,GAAG,CAAC;QACtB,IAAI;YACF,OAAO,MAAM,yMAAQ,CAAC,OAAO,CAAC;QAChC,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,8BAA8B;YAC5C,OAAO,aAAa,GAAG;YACvB,MAAM;QACR;IACF,CAAC;IAED,OAAO,OAAO,aAAa;AAC7B"}},
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rafi2/Rank%20Time%20%28Vibe%29/ranktime/src/models/User.ts"],"sourcesContent":["import mongoose, { Document, Schema } from 'mongoose';\r\n\r\nexport interface IUser extends Document {\r\n  name: string;\r\n  email: string;\r\n  emailVerified?: Date;\r\n  image?: string;\r\n  codeforcesHandle?: string;\r\n  usertag: string; // Unique random tag for each user\r\n  following: mongoose.Types.ObjectId[]; // Array of user IDs this user follows\r\n  totalScore: number;\r\n  currentStreak: number;\r\n  maxStreak: number;\r\n  lastSessionDate?: Date;\r\n  league: 'bronze' | 'silver' | 'gold' | 'platinum' | 'diamond' | 'master' | 'grandmaster';\r\n  rank: number;\r\n  totalSessions: number;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nconst UserSchema = new Schema<IUser>(\r\n  {\r\n    name: { type: String, required: true },\r\n    email: { type: String, required: true, unique: true },\r\n    emailVerified: { type: Date },\r\n    image: { type: String },\r\n    codeforcesHandle: { type: String },\r\n    usertag: { type: String, required: true, unique: true },\r\n    following: [{ type: Schema.Types.ObjectId, ref: 'User' }],\r\n    totalScore: { type: Number, default: 0 },\r\n    currentStreak: { type: Number, default: 0 },\r\n    maxStreak: { type: Number, default: 0 },\r\n    lastSessionDate: { type: Date },\r\n    league: {\r\n      type: String,\r\n      enum: ['bronze', 'silver', 'gold', 'platinum', 'diamond', 'master', 'grandmaster'],\r\n      default: 'bronze',\r\n    },\r\n    rank: { type: Number, default: 0 },\r\n    totalSessions: { type: Number, default: 0 },\r\n  },\r\n  { timestamps: true }\r\n);\r\n\r\n// Create a model or use the existing one if it's already been created\r\nexport default mongoose.models?.User || mongoose.model<IUser>('User', UserSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAqBA,MAAM,aAAa,IAAI,wMAAM,CAC3B;IACE,MAAM;QAAE,MAAM;QAAQ,UAAU;IAAK;IACrC,OAAO;QAAE,MAAM;QAAQ,UAAU;QAAM,QAAQ;IAAK;IACpD,eAAe;QAAE,MAAM;IAAK;IAC5B,OAAO;QAAE,MAAM;IAAO;IACtB,kBAAkB;QAAE,MAAM;IAAO;IACjC,SAAS;QAAE,MAAM;QAAQ,UAAU;QAAM,QAAQ;IAAK;IACtD,WAAW;QAAC;YAAE,MAAM,wMAAM,CAAC,KAAK,CAAC,QAAQ;YAAE,KAAK;QAAO;KAAE;IACzD,YAAY;QAAE,MAAM;QAAQ,SAAS;IAAE;IACvC,eAAe;QAAE,MAAM;QAAQ,SAAS;IAAE;IAC1C,WAAW;QAAE,MAAM;QAAQ,SAAS;IAAE;IACtC,iBAAiB;QAAE,MAAM;IAAK;IAC9B,QAAQ;QACN,MAAM;QACN,MAAM;YAAC;YAAU;YAAU;YAAQ;YAAY;YAAW;YAAU;SAAc;QAClF,SAAS;IACX;IACA,MAAM;QAAE,MAAM;QAAQ,SAAS;IAAE;IACjC,eAAe;QAAE,MAAM;QAAQ,SAAS;IAAE;AAC5C,GACA;IAAE,YAAY;AAAK;uCAIN,yMAAQ,CAAC,MAAM,EAAE,QAAQ,yMAAQ,CAAC,KAAK,CAAQ,QAAQ"}},
    {"offset": {"line": 186, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rafi2/Rank%20Time%20%28Vibe%29/ranktime/src/models/Session.ts"],"sourcesContent":["import mongoose, { Document, Schema, Types } from 'mongoose';\r\n\r\nexport interface ILap {\r\n  name: string;\r\n  duration: number; // in seconds\r\n  startedAt: Date;\r\n  endedAt: Date;\r\n  comment?: string;\r\n}\r\n\r\nexport interface ISession extends Document {\r\n  user: Types.ObjectId;\r\n  problemId: string;\r\n  problemName: string;\r\n  problemUrl: string;\r\n  problemRating: number;\r\n  problemTags: string[];\r\n  laps: ILap[];\r\n  totalTime: number; // in seconds\r\n  score: number;\r\n  streakBonus: number;\r\n  notes?: string;\r\n  comments?: string;\r\n  codeforcesHandle: string;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nconst LapSchema = new Schema<ILap>({\r\n  name: { type: String, required: true },\r\n  duration: { type: Number, required: true },\r\n  startedAt: { type: Date, required: true },\r\n  endedAt: { type: Date, required: true },\r\n  comment: { type: String },\r\n});\r\n\r\nconst SessionSchema = new Schema<ISession>(\r\n  {\r\n    user: { type: Schema.Types.ObjectId, ref: 'User', required: true },\r\n    problemId: { type: String, required: true },\r\n    problemName: { type: String, required: true },\r\n    problemUrl: { type: String, required: true },\r\n    problemRating: { type: Number, required: true },\r\n    problemTags: [{ type: String }],\r\n    laps: [LapSchema],\r\n    totalTime: { type: Number, required: true },\r\n    score: { type: Number, required: true },\r\n    streakBonus: { type: Number, default: 0 },\r\n    notes: { type: String },\r\n    comments: { type: String },\r\n    codeforcesHandle: { type: String, required: true },\r\n  },\r\n  { timestamps: true }\r\n);\r\n\r\n// Create index for faster queries\r\nSessionSchema.index({ user: 1, createdAt: -1 });\r\n\r\n// Create a model or use the existing one if it's already been created\r\nexport default mongoose.models?.Session || mongoose.model<ISession>('Session', SessionSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AA4BA,MAAM,YAAY,IAAI,wMAAM,CAAO;IACjC,MAAM;QAAE,MAAM;QAAQ,UAAU;IAAK;IACrC,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,WAAW;QAAE,MAAM;QAAM,UAAU;IAAK;IACxC,SAAS;QAAE,MAAM;QAAM,UAAU;IAAK;IACtC,SAAS;QAAE,MAAM;IAAO;AAC1B;AAEA,MAAM,gBAAgB,IAAI,wMAAM,CAC9B;IACE,MAAM;QAAE,MAAM,wMAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;QAAQ,UAAU;IAAK;IACjE,WAAW;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC1C,aAAa;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC5C,YAAY;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC3C,eAAe;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC9C,aAAa;QAAC;YAAE,MAAM;QAAO;KAAE;IAC/B,MAAM;QAAC;KAAU;IACjB,WAAW;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC1C,OAAO;QAAE,MAAM;QAAQ,UAAU;IAAK;IACtC,aAAa;QAAE,MAAM;QAAQ,SAAS;IAAE;IACxC,OAAO;QAAE,MAAM;IAAO;IACtB,UAAU;QAAE,MAAM;IAAO;IACzB,kBAAkB;QAAE,MAAM;QAAQ,UAAU;IAAK;AACnD,GACA;IAAE,YAAY;AAAK;AAGrB,kCAAkC;AAClC,cAAc,KAAK,CAAC;IAAE,MAAM;IAAG,WAAW,CAAC;AAAE;uCAG9B,yMAAQ,CAAC,MAAM,EAAE,WAAW,yMAAQ,CAAC,KAAK,CAAW,WAAW"}},
    {"offset": {"line": 278, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rafi2/Rank%20Time%20%28Vibe%29/ranktime/src/app/api/leaderboard/route.ts"],"sourcesContent":["// src/app/api/leaderboard/route.ts\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/db';\r\nimport User from '@/models/User';\r\nimport Session from '@/models/Session';\r\n\r\nexport const dynamic = 'force-dynamic';\r\nexport const runtime = 'nodejs';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n\r\n    const { searchParams } = new URL(request.url);\r\n    const sortBy = searchParams.get('sort') || 'totalScore';\r\n    const timeRange = searchParams.get('timeRange') || 'all';\r\n\r\n    let users = await User.find({}).select(\r\n      'name email totalScore currentStreak maxStreak rank league totalSessions'\r\n    );\r\n\r\n    // Calculate time-based stats if needed\r\n    if (timeRange !== 'all') {\r\n      const startDate = new Date();\r\n      if (timeRange === 'month') {\r\n        startDate.setMonth(startDate.getMonth() - 1);\r\n      } else if (timeRange === 'week') {\r\n        startDate.setDate(startDate.getDate() - 7);\r\n      }\r\n\r\n      // Get sessions within time range for each user\r\n      for (const user of users) {\r\n        const sessions = await Session.find({\r\n          userId: user._id,\r\n          createdAt: { $gte: startDate }\r\n        });\r\n\r\n        if (sortBy === 'totalScore') {\r\n          user.totalScore = sessions.reduce((sum, session) => sum + session.score, 0);\r\n        } else if (sortBy === 'averageScore') {\r\n          user.averageScore = sessions.length > 0\r\n            ? sessions.reduce((sum, session) => sum + session.score, 0) / sessions.length\r\n            : 0;\r\n        } else if (sortBy === 'totalSessions') {\r\n          user.totalSessions = sessions.length;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Calculate average score for all users\r\n    for (const user of users) {\r\n      if (!user.averageScore) {\r\n        const sessions = await Session.find({ userId: user._id });\r\n        user.averageScore = sessions.length > 0\r\n          ? sessions.reduce((sum, session) => sum + session.score, 0) / sessions.length\r\n          : 0;\r\n      }\r\n    }\r\n\r\n    // Sort users based on the selected criteria\r\n    users.sort((a, b) => {\r\n      let aValue, bValue;\r\n\r\n      switch (sortBy) {\r\n        case 'totalScore':\r\n          aValue = a.totalScore;\r\n          bValue = b.totalScore;\r\n          break;\r\n        case 'currentStreak':\r\n          aValue = a.currentStreak;\r\n          bValue = b.currentStreak;\r\n          break;\r\n        case 'maxStreak':\r\n          aValue = a.maxStreak;\r\n          bValue = b.maxStreak;\r\n          break;\r\n        case 'averageScore':\r\n          aValue = a.averageScore;\r\n          bValue = b.averageScore;\r\n          break;\r\n        case 'totalSessions':\r\n          aValue = a.totalSessions;\r\n          bValue = b.totalSessions;\r\n          break;\r\n        default:\r\n          aValue = a.totalScore;\r\n          bValue = b.totalScore;\r\n      }\r\n\r\n      return bValue - aValue; // Descending order\r\n    });\r\n\r\n    // Update ranks\r\n    users.forEach((user, index) => {\r\n      user.rank = index + 1;\r\n    });\r\n\r\n    return NextResponse.json(users);\r\n\r\n  } catch (error) {\r\n    console.error('Error fetching leaderboard:', error);\r\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":";;;;;;;;AAAA,mCAAmC;AACnC;AACA;AACA;AACA;;;;;AAEO,MAAM,UAAU;AAChB,MAAM,UAAU;AAEhB,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,IAAA,mKAAS;QAEf,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,SAAS,aAAa,GAAG,CAAC,WAAW;QAC3C,MAAM,YAAY,aAAa,GAAG,CAAC,gBAAgB;QAEnD,IAAI,QAAQ,MAAM,wKAAI,CAAC,IAAI,CAAC,CAAC,GAAG,MAAM,CACpC;QAGF,uCAAuC;QACvC,IAAI,cAAc,OAAO;YACvB,MAAM,YAAY,IAAI;YACtB,IAAI,cAAc,SAAS;gBACzB,UAAU,QAAQ,CAAC,UAAU,QAAQ,KAAK;YAC5C,OAAO,IAAI,cAAc,QAAQ;gBAC/B,UAAU,OAAO,CAAC,UAAU,OAAO,KAAK;YAC1C;YAEA,+CAA+C;YAC/C,KAAK,MAAM,QAAQ,MAAO;gBACxB,MAAM,WAAW,MAAM,2KAAO,CAAC,IAAI,CAAC;oBAClC,QAAQ,KAAK,GAAG;oBAChB,WAAW;wBAAE,MAAM;oBAAU;gBAC/B;gBAEA,IAAI,WAAW,cAAc;oBAC3B,KAAK,UAAU,GAAG,SAAS,MAAM,CAAC,CAAC,KAAK,UAAY,MAAM,QAAQ,KAAK,EAAE;gBAC3E,OAAO,IAAI,WAAW,gBAAgB;oBACpC,KAAK,YAAY,GAAG,SAAS,MAAM,GAAG,IAClC,SAAS,MAAM,CAAC,CAAC,KAAK,UAAY,MAAM,QAAQ,KAAK,EAAE,KAAK,SAAS,MAAM,GAC3E;gBACN,OAAO,IAAI,WAAW,iBAAiB;oBACrC,KAAK,aAAa,GAAG,SAAS,MAAM;gBACtC;YACF;QACF;QAEA,wCAAwC;QACxC,KAAK,MAAM,QAAQ,MAAO;YACxB,IAAI,CAAC,KAAK,YAAY,EAAE;gBACtB,MAAM,WAAW,MAAM,2KAAO,CAAC,IAAI,CAAC;oBAAE,QAAQ,KAAK,GAAG;gBAAC;gBACvD,KAAK,YAAY,GAAG,SAAS,MAAM,GAAG,IAClC,SAAS,MAAM,CAAC,CAAC,KAAK,UAAY,MAAM,QAAQ,KAAK,EAAE,KAAK,SAAS,MAAM,GAC3E;YACN;QACF;QAEA,4CAA4C;QAC5C,MAAM,IAAI,CAAC,CAAC,GAAG;YACb,IAAI,QAAQ;YAEZ,OAAQ;gBACN,KAAK;oBACH,SAAS,EAAE,UAAU;oBACrB,SAAS,EAAE,UAAU;oBACrB;gBACF,KAAK;oBACH,SAAS,EAAE,aAAa;oBACxB,SAAS,EAAE,aAAa;oBACxB;gBACF,KAAK;oBACH,SAAS,EAAE,SAAS;oBACpB,SAAS,EAAE,SAAS;oBACpB;gBACF,KAAK;oBACH,SAAS,EAAE,YAAY;oBACvB,SAAS,EAAE,YAAY;oBACvB;gBACF,KAAK;oBACH,SAAS,EAAE,aAAa;oBACxB,SAAS,EAAE,aAAa;oBACxB;gBACF;oBACE,SAAS,EAAE,UAAU;oBACrB,SAAS,EAAE,UAAU;YACzB;YAEA,OAAO,SAAS,QAAQ,mBAAmB;QAC7C;QAEA,eAAe;QACf,MAAM,OAAO,CAAC,CAAC,MAAM;YACnB,KAAK,IAAI,GAAG,QAAQ;QACtB;QAEA,OAAO,sLAAY,CAAC,IAAI,CAAC;IAE3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,sLAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}